<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Gestión de Errores QA</title>
  <link rel="stylesheet" href="styles.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
  <header class="container py-4 d-flex justify-content-between align-items-center">
    <div>
      <h1 class="mb-1">Gestión de Errores QA</h1>
      <p class="text-muted">Consulta, edita, elimina y agrega reportes. Exporta a Excel.</p>
    </div>
    <div class="d-flex gap-2">
      <button id="themeToggle" class="btn btn-outline-secondary fs-4" aria-label="Cambiar tema">🌞</button>
      <button id="logoutBtn" class="btn btn-outline-danger">Cerrar sesión</button>
    </div>
  </header>

  <main class="container">
    <!-- filtros -->
    <form id="filterForm" class="row g-3 mb-4">
      <div class="col-md-4">
        <label for="filterProyecto" class="form-label">Proyecto</label>
        <select id="filterProyecto" class="form-select"></select>
      </div>
      <div class="col-md-4">
        <label for="filterSolicitud" class="form-label">Solicitud</label>
        <select id="filterSolicitud" class="form-select"></select>
      </div>
      <div class="col-md-4 d-flex align-items-end gap-2">
        <button type="submit" class="btn btn-primary">Filtrar</button>
        <button type="button" id="btnResetFilters" class="btn btn-secondary">Resetear</button>
      </div>
    </form>

    <!-- tabla -->
    <div class="table-responsive mb-4">
      <table id="reportTable" class="table table-striped table-bordered">
        <thead>
          <tr>
            <th>Reporte</th>
            <th>Fecha</th>
            <th>Solicitud</th>
            <th>Proyecto</th>
            <th>Resultado</th>
            <th>Estado</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
      <p id="emptyState" class="d-none">No hay reportes.</p>
    </div>

    <!-- formulario agregar -->
    <form id="addForm" class="row g-3 mb-4">
      <div class="col-md-3">
        <input type="text" id="addReporte" class="form-control" placeholder="Reporte" required>
      </div>
      <div class="col-md-2">
        <input type="date" id="addFecha" class="form-control" required>
      </div>
      <div class="col-md-2">
        <input type="text" id="addSolicitud" class="form-control" placeholder="Solicitud" required>
      </div>
      <div class="col-md-2">
        <input type="text" id="addProyecto" class="form-control" placeholder="Proyecto" required>
      </div>
      <div class="col-md-2">
        <input type="text" id="addResultado" class="form-control" placeholder="Resultado">
      </div>
      <div class="col-md-1">
        <select id="addEstado" class="form-select">
          <option value="Pendiente">Pendiente</option>
          <option value="Reportado">Reportado</option>
          <option value="Resuelto">Resuelto</option>
        </select>
      </div>
      <div class="col-12">
        <button type="submit" class="btn btn-success">Agregar Reporte</button>
      </div>
    </form>

    <!-- exportar -->
    <div class="mb-4">
      <button id="btnExport" class="btn btn-outline-info">Exportar a Excel</button>
    </div>
  </main>

  <!-- Validación de token y logout -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const token = localStorage.getItem("token");
      if (!token) {
        window.location.href = "/index.html"; // vuelve al login si no hay token
        return;
      }

      // Logout
      const logoutBtn = document.getElementById("logoutBtn");
      if (logoutBtn) {
        logoutBtn.addEventListener("click", () => {
          localStorage.removeItem("token");
          window.location.href = "/index.html";
        });
      }
    });
  </script>

  <!-- script de la app -->
  <script src="script.js"></script>
</body>
</html>
